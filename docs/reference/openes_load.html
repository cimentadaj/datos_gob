<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extract data and metadata from a given data set of <a href='https://datos.gob.es/'>https://datos.gob.es/</a> — openes_load • opendataes</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Extract data and metadata from a given data set of <a href='https://datos.gob.es/'>https://datos.gob.es/</a> — openes_load" />

<meta property="og:description" content="Extract data and metadata from a given data set of https://datos.gob.es/" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">opendataes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/ins-and-outs-of-opendataes-guide-for-collaboration.html">Ins and outs  of opendataes: a guide for collaboration</a>
    </li>
    <li>
      <a href="../articles/understanding-opendataes-a-case-study-approach.html">Understanding opendataes: a case study approach</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropenspain/opendataes">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract data and metadata from a given data set of <a href='https://datos.gob.es/'>https://datos.gob.es/</a></h1>
    <small class="dont-index">Source: <a href='https://github.com/ropenspain/opendataes/blob/master/R/openes_load.R'><code>R/openes_load.R</code></a></small>
    <div class="hidden name"><code>openes_load.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Extract data and metadata from a given data set of <a href='https://datos.gob.es/'>https://datos.gob.es/</a></p>
    
    </div>

    <pre class="usage"><span class='fu'>openes_load</span>(<span class='no'>x</span>, <span class='kw'>encoding</span> <span class='kw'>=</span> <span class='st'>"UTF-8"</span>, <span class='kw'>guess_encoding</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A <code><a href='https://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code> given by <code><a href='openes_keywords.html'>openes_keywords</a></code> only containing one dataset (1 row) or
the end path of a dataset such as 'l01280148-seguridad-ciudadana-actuaciones-de-seccion-del-menor-en-educacion-vial-20141'
from <a href='https://datos.gob.es/es/catalogo/l01280148-seguridad-ciudadana-actuaciones-de-seccion-del-menor-en-educacion-vial-20141'>https://datos.gob.es/es/catalogo/l01280148-seguridad-ciudadana-actuaciones-de-seccion-del-menor-en-educacion-vial-20141</a>.</p></td>
    </tr>
    <tr>
      <th>encoding</th>
      <td><p>The encoding passed to read (all) the files. Most cases should be resolved with either
'UTF-8', 'latin1' or 'ASCII'.</p></td>
    </tr>
    <tr>
      <th>guess_encoding</th>
      <td><p>A logical stating whether to guess the encoding. This is set to TRUE by default.
Whenever guess_encoding is set to TRUE, the 'encoding' argument is ignored. If <code><a href='https://readr.tidyverse.org/reference/encoding.html'>guess_encoding</a></code>
fails to guess the encoding, openes_load falls back to the encoding argument.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments passed to <code><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></code> and the other related <code>read_*</code> functions from <code><a href='https://readr.tidyverse.org/reference/readr-package.html'>readr</a></code>.
Internally, <code>openes_load</code> determines the delimiter of the file being read but the arguments
for each of these functions are practically the same, so it doesn't matter how <code>openes_load</code>
determines the delimiter, any of the arguments will work on all <code>read_*</code> functions.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>if <code>path_id</code> is a valid dataset path, a list with two slots: metadata and data. Each slot
contains <code><a href='https://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code>'s that contain either metadata or the data itself. If <code>path_id</code>
is not a valid dataset path, it returns an empty list. See the details section for some caveats.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>openes_load</code> can return two possible outcomes: either an empty list or a list with a slot called metadata
and another slot called data. Whenever the <code>path_id</code> argument is an invalid dataset path, it will return an empty list.
When <code>path_id</code> is a valid dataset path, <code>openes_load</code> will return an a list with the two slots described above.</p>
<p>For the metadata slot, <code>openes_load</code> returns a <code><a href='https://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code> with most available metadata of the dataset.
The columns are:</p>
<ul>
<li><p>keywords: the available keywords from the dataset in the homepage of the dataset.</p></li>
<li><p>language: the available languages of the dataset's metadata. Note that that this does not mean that the dataset
is in different languages but only the metadata.</p></li>
<li><p>description: a short description of the data being read.</p></li>
<li><p>url: the complete url of the dataset in <a href='https://datos.gob.es/'>https://datos.gob.es/</a>. Note that this URL is not the access URL to the dataset
but to the dataset's homepage in <a href='https://datos.gob.es/'>https://datos.gob.es/</a>.</p></li>
<li><p>date_issued: the date at which the dataset was uploaded.</p></li>
<li><p>date_modified: the date at which the last dataset was uploaded. If the dataset has only been uploaded once, this
will return <code>'No modification date available'</code>.</p></li>
<li><p>publisher: the entity that publishes the dataset. See <code><a href='openes_load_publishers.html'>openes_load_publishers</a></code> for all available publishers.</p></li>
<li><p>publisher_data_url: the homepage of the dataset in the website of the publisher. This is helpful to look
at the definitions of the columns in the dataset.</p></li>
</ul>
    <p>The metadata of the API can sometimes be returned in an incorrect order. For example, there are cases when there are several
languages available and the order of the different descriptions are not in the same order of the languages. If you
find any of these errors, try raising the issue directly to <a href='https://datos.gob.es/'>https://datos.gob.es/</a> as the package extracts all
metadata in the same order as it is.</p>
<p>Whenever the metadata is in different languages, the resulting <code><a href='https://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code> will have
the same numer of rows as there are languages containing the different texts in different languages and
repeating the same information whenever it's similar across languages (such as the dates, which are language agnostic).</p>
<p>In case the API returns empty requests, both data and metadata will be empty <code><a href='https://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code>'s
with the same column names.</p>
<p>For the data slot, <code>openes_load</code> returns a list containing at least one <code><a href='https://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code>.
If the dataset being request has file formats that <code>openes_load</code> can read (see <code><a href='permitted_formats.html'>permitted_formats</a></code>)
it will read those files. If that dataset has several files, then it will return a list of the same length
as there are datasets where each slot in that list is a <code><a href='https://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code> with the data. If for
some reason any of the datasets being read cannot be read, <code>openes_load</code> has a fall back mechanism
that returns the format that attempted to read together with the URL so that the user can try to read the
dataset directly. In any case, the result will always be a list with <code><a href='https://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code>'s
where each one could be the requested dataset (success) or a dataset with the format and url that attempted
to read but failed (failure).</p>
<p>Inside the data slot, each list slot containing <code><a href='https://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code>'s will be named according
to the dataset that was read. When there is more than one dataset, the user can then enter the website
in the <code>url</code> column in the metadata slot to see all names of the datasets. This is handy, for example,
when the same dataset is repeated across time and we want to figure out which data is which from the slot.</p>
<p>The API of <a href='https://datos.gob.es/'>https://datos.gob.es/</a> is not completely homogenous because it is an aggregator
of many different API's from different cities and provinces of Spain. <code>openes_load</code> can only read
a limited number of file formats but will keep increasing as the package evolves. You can check the available file formats
in <code><a href='permitted_formats.html'>permitted_formats</a></code>. If the file format of the requested <code>path_id</code> is not readable, <code>openes_load</code>
will return a list with only one <code><a href='https://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code> with all available formats with their respective data URL
inside the data slot so that users can read the manually.</p>
<p>In a similar line, in order for <code>openes_load</code> to provide the safest behavior, it is very conservative in which
publisher it can read from <a href='https://datos.gob.es/'>https://datos.gob.es/</a>. Because some publishers do not have standardized datasets,
reading many different publishers can become very messy. <code>openes_load</code> currently reads files from selected
publishers because they offer standardized datasets which makes it safer to read. As the package evolves and the
data quality improves between publishers, the package will include more publishers. See the publishers that the
package can read in <code><a href='publishers_available.html'>publishers_available</a></code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># For a dataset with only one file to read</span>
<span class='no'>example_id</span> <span class='kw'>&lt;-</span> <span class='st'>'l01080193-fecundidad-madres-de-15-a-19-anos-quinquenal-2003-2014'</span>
<span class='no'>some_data</span> <span class='kw'>&lt;-</span> <span class='fu'>openes_load</span>(<span class='no'>example_id</span>)

<span class='co'># Print the file to get some useful information</span>
<span class='no'>some_data</span></div><div class='output co'>#&gt; &lt;datos.gob.es API&gt;
#&gt;    Description: Fecundidad madres de 15 a 19 años (quinquenal). 2003-2014
#&gt;    Publisher: Ayuntamiento de Barcelona
#&gt;    Languages: es, ca, en
#&gt;    Date of release: NA
#&gt;    # of files read: 1 out of 1</div><div class='input'>
<span class='co'># Access the metadata</span>
<span class='no'>some_data</span>$<span class='no'>metadata</span></div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 3 x 8</span><span>
#&gt;   keywords language description url   date_issued         date_modified
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>              </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>        
#&gt; </span><span style='color: #555555;'>1</span><span> Barrios~ es       Fecundidad~ http~ </span><span style='color: #BB0000;'>NA</span><span>                  No modificat~
#&gt; </span><span style='color: #555555;'>2</span><span> Barrios~ ca       Fecunditat~ http~ </span><span style='color: #BB0000;'>NA</span><span>                  No modificat~
#&gt; </span><span style='color: #555555;'>3</span><span> Barrios~ en       Fertility ~ http~ </span><span style='color: #BB0000;'>NA</span><span>                  No modificat~
#&gt; </span><span style='color: #555555;'># ... with 2 more variables: publisher </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, publisher_data_url </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span></div><div class='input'>
<span class='co'># Access the data. Note that the name of the dataset is in the list slot. Whenever</span>
<span class='co'># there are different files being read, you might want to enter to homepage</span>
<span class='co'># of the dataset in datos.gob.es with some_data$metadata$url or directly</span>
<span class='co'># to the homepage of dataset at the publisher's website</span>
<span class='co'># some_data$metadata$publisher_data_url</span>
<span class='no'>some_data</span>$<span class='no'>data</span></div><div class='output co'>#&gt; $t02.csv
#&gt; </span><span style='color: #555555;'># A tibble: 75 x 11</span><span>
#&gt;    Dte.  Barris `2003-2007` `2004-2008` `2005-2009` `2006-2010` `2007-2011`
#&gt;    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 1</span><span> BARC~ </span><span style='color: #BB0000;'>NA</span><span>            </span><span style='text-decoration: underline;'>1</span><span>359        </span><span style='text-decoration: underline;'>1</span><span>381        </span><span style='text-decoration: underline;'>1</span><span>404        </span><span style='text-decoration: underline;'>1</span><span>363        </span><span style='text-decoration: underline;'>1</span><span>310
#&gt; </span><span style='color: #555555;'> 2</span><span> 1     1. el~          76          77          80          78          79
#&gt; </span><span style='color: #555555;'> 3</span><span> 1     2. el~          19          16          13          10           9
#&gt; </span><span style='color: #555555;'> 4</span><span> 1     3. la~          15          14          17          18          15
#&gt; </span><span style='color: #555555;'> 5</span><span> 1     4. Sa~          24          27          23          24          25
#&gt; </span><span style='color: #555555;'> 6</span><span> 2     5. el~          15          11          15          12          10
#&gt; </span><span style='color: #555555;'> 7</span><span> 2     6. la~          28          20          17          16          16
#&gt; </span><span style='color: #555555;'> 8</span><span> 2     7. la~          10          10           7           6           5
#&gt; </span><span style='color: #555555;'> 9</span><span> 2     8. l'~          13          17          16          14          14
#&gt; </span><span style='color: #555555;'>10</span><span> 2     9. la~          19          21          21          18          18
#&gt; </span><span style='color: #555555;'># ... with 65 more rows, and 4 more variables: `2008-2012` </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
#&gt; #   `2009-2013` </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, `2010-2014` </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, `2011-2015` </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </div><div class='input'>
# For a dataset with many files

</div></span># NOT RUN {
example_id <- 'l01080193-domicilios-segun-nacionalidad'
res <- openes_load(example_id)

# Note that you can see how many files were read in '# of files read'
res

# See how all datasets were read but we're not sure what each one means.
# Check the metadata and read the description. If that doesn't do it,
# go to the URL of the dataset from the metadata.
res$data

# Also note that some of the datasets were not read uniformly correct. For example,
# some of these datasets were read with more columns or more rows. This is left
# to the user to fix. We could've added new arguments to the `...` but that would
# apply to ALL datasets and it then becomes too complicated.


# Encoding problems

long <- "l01080193-descripcion-de-la-causalidad-de-los-accidentes"
string <- "-gestionados-por-la-guardia-urbana-en-la-ciudad-de-barcelona"

id <- paste0(long, string)
pl <- openes_load(id)

# The dataset is read successfully but once we print them, there's an error
pl$data
$`2011_ACCIDENTS_CAUSES_GU_BCN_.csv`
Error in nchar(x[is_na], type = "width") :
  invalid multibyte string, element 1

# This error is due to an encoding problem.
# We can use readr::guess_encoding to determine the encoding and reread

# This suggests an ASCII encoding
library(readr)
guess_encoding(pl$data[[1]])

pl <- openes_load(id, 'ASCII')

# Success
pl$data


# For exploring datasets with openes_keywords and piping to openes_load
library(dplyr)

kw <- openes_keywords("turismo", "l01080193") # Ayuntamiento de Barcelona#'
kw

dts <-
 kw %>%
 filter(is_readable == TRUE,
        grepl("Tipos de propietarios", description)) %>% # Narrow it down to only 1 dataset
 openes_load()

dts$metadata

dts$data
# }
<div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jorge Cimentada, Jorge Lopez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

